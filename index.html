<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Namastakip</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#121824; --panel2:#0f1520;
      --text:#e8eef7; --muted:#9fb0c7; --line:#223049;
      --green:#2ee59d; --black:#0b0b0b; --danger:#ff5a6a; --accent:#5ad1ff;
      --cell:42px; --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(900px 600px at 10% 0%, #0f1a2e 0%, var(--bg) 55%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:30;
      background: linear-gradient(180deg, rgba(11,15,20,.96), rgba(11,15,20,.78));
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar{
      max-width:1200px; margin:0 auto; padding:12px 14px;
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;line-height:1.35;margin-top:6px}
    .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end}
    .btn, select, input{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(18,24,36,.95), rgba(15,21,32,.95));
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    .btn{cursor:pointer; user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.ok{border-color: rgba(46,229,157,.45)}
    .btn.danger{border-color: rgba(255,90,106,.45)}
    .btn.ghost{background: rgba(0,0,0,.10)}

    main{
      max-width:1200px; margin:0 auto; padding:14px 14px 40px;
      display:grid; grid-template-columns: 1.55fr .95fr; gap:14px;
    }
    @media (max-width:980px){ main{grid-template-columns:1fr} .controls{justify-content:flex-start} }

    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(18,24,36,.96), rgba(15,21,32,.96));
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      overflow:hidden;
    }
    .hd{
      padding:12px 12px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .hd b{font-size:14px; letter-spacing:.2px}
    .bd{padding:12px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      padding:7px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    /* table wrap */
    .tableWrap{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      border:1px solid var(--line);
      border-radius:12px;
    }
    table{
      width:100%;
      min-width: 780px; /* iPhone: verhindert Kollaps */
      border-collapse:separate;
      border-spacing:0;
    }
    thead th{
      position: sticky; top:0; z-index:6;
      background: rgba(18,24,36,.98);
      border-bottom:1px solid var(--line);
    }
    th, td{
      padding:10px 10px;
      text-align:center;
      font-size:14px;
      border-bottom:1px solid rgba(34,48,73,.55);
    }
    /* sticky date column */
    th:first-child, td:first-child{
      text-align:left;
      position: sticky; left:0; z-index:5;
      background: rgba(18,24,36,.98);
      border-right:1px solid rgba(34,48,73,.55);
      min-width: 175px;
    }
    tbody tr:hover td{ background: rgba(255,255,255,.02); }
    tbody tr:hover td:first-child{ background: rgba(18,24,36,.98); }

    .phead{font-size:12px;color:var(--muted);letter-spacing:.2px}
    .cellBtn{
      width:var(--cell); height:var(--cell);
      border-radius:12px;
      border:1px solid rgba(34,48,73,.65);
      background: rgba(0,0,0,.14);
      display:inline-flex; align-items:center; justify-content:center;
      font-size:18px;
      cursor:pointer;
      user-select:none;
    }
    .cellBtn:active{transform:translateY(1px)}
    .state0{ color: transparent; } /* leer */
    .state1{
      color:#061b12;
      background: linear-gradient(180deg, rgba(46,229,157,.95), rgba(46,229,157,.65));
      border-color: rgba(46,229,157,.55);
      box-shadow: 0 6px 14px rgba(46,229,157,.12);
    }
    .state2{
      color:#fff;
      background: linear-gradient(180deg, rgba(11,11,11,.95), rgba(11,11,11,.75));
      border-color: rgba(255,255,255,.18);
    }

    .muted{color:var(--muted);font-size:13px;line-height:1.35}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:520px){ .grid2{grid-template-columns:1fr} }

    .pillRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .metric{
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
      padding:12px;
    }
    .metric h3{margin:0 0 8px 0; font-size:13px; color:var(--muted); letter-spacing:.2px}
    .big{
      font-weight:800;
      font-size:20px;
      letter-spacing:.2px;
      margin:4px 0 0 0;
    }
    .bar{
      height:12px;
      border-radius:999px;
      border:1px solid rgba(34,48,73,.8);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      margin-top:10px;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(90,209,255,.95), rgba(46,229,157,.95));
    }
    .rows{display:grid; gap:8px; margin-top:10px}
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 12px;
      border:1px solid rgba(34,48,73,.6);
      background: rgba(0,0,0,.12);
      border-radius: 12px;
      font-size:14px;
    }
    .badge{
      font-variant-numeric: tabular-nums;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(34,48,73,.7);
      background: rgba(255,255,255,.04);
      min-width: 56px;
      text-align:center;
    }
    textarea{
      width:100%;
      min-height:140px;
      resize:vertical;
      font-size:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px;
      outline:none;
    }
    input[type="file"]{display:none}
    .actions{display:flex; flex-wrap:wrap; gap:10px; help:1}
  </style>
</head>
<body>

<header>
  <div class="topbar">
    <div>
      <h1>Namastakip</h1>
      <div class="sub">
        Tippen: <b>leer</b> → <span style="color:var(--green);font-weight:800;">Eda</span> → <b>⚫ Kaza</b> → leer.
        <br/>Wichtig: Nutze „<b>Backup speichern</b>“ für ewiges Archiv (iCloud/Handywechsel).
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="btnToday">Heute</button>

      <span class="pill">Jahr:
        <select id="selYear"></select>
      </span>

      <span class="pill">Monat:
        <select id="selMonth"></select>
      </span>

      <button class="btn danger" id="btnClearMonth">Monat löschen</button>
    </div>
  </div>
</header>

<main>
  <!-- LEFT -->
  <section class="card">
    <div class="hd">
      <b>Tabelle</b>
      <span class="pill" id="rangeLabel">Zeitraum: –</span>
    </div>
    <div class="bd">
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>Datum</th>
              <th class="phead">Sabah</th>
              <th class="phead">Öğle</th>
              <th class="phead">İkindi</th>
              <th class="phead">Akşam</th>
              <th class="phead">Yatsı</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="muted" style="margin-top:10px;">
        Hinweis: Diese Ansicht lädt immer nur einen Monat (schnell auf iPhone). Deine Daten gelten trotzdem für alle Jahre.
      </div>
    </div>
  </section>

  <!-- RIGHT -->
  <aside class="card">
    <div class="hd">
      <b>Archiv & Fortschritt</b>
      <span class="pill" id="saveState">Autosave ✅</span>
    </div>

    <div class="bd">
      <!-- Settings -->
      <div class="metric">
        <h3>Einstellungen</h3>
        <div class="muted">Geburtsdatum (für Pflicht-Berechnung):</div>
        <div class="actions" style="margin-top:8px;">
          <input id="birthDate" type="date" />
          <span class="pill">Pflicht ab <b>&nbsp;10&nbsp;</b> Jahren</span>
          <button class="btn ok" id="btnApplyBirth">Übernehmen</button>
        </div>
        <div class="muted" style="margin-top:8px;">
          Tipp: Trage dein echtes Geburtsdatum ein, damit „Pflicht seit …“ exakt stimmt.
        </div>
      </div>

      <div style="height:12px;"></div>

      <!-- Progress -->
      <div class="metric">
        <h3>Gesamt-Fortschritt seit Pflicht</h3>
        <div class="rows">
          <div class="row">
            <div>Pflicht seit</div>
            <div class="badge" id="sinceLabel">–</div>
          </div>
          <div class="row">
            <div>Pflicht-Tage</div>
            <div class="badge" id="daysReq">0</div>
          </div>
          <div class="row">
            <div>Gebete nötig (5/Tag)</div>
            <div class="badge" id="prayersReq">0</div>
          </div>
          <div class="row">
            <div>Erledigt (Eda + Kaza)</div>
            <div class="badge" id="prayersDone">0</div>
          </div>
          <div class="row">
            <div>Noch offen</div>
            <div class="badge" id="prayersLeft">0</div>
          </div>
        </div>
        <div class="bar" aria-label="Fortschritt">
          <div id="barFill"></div>
        </div>
        <div class="muted" style="margin-top:8px;">
          Der Balken zeigt: erledigt / nötig. (Eda + Kaza zählen als „erledigt“.)
        </div>
      </div>

      <div style="height:12px;"></div>

      <!-- Trackers -->
      <div class="metric">
        <h3>Tracker</h3>
        <div class="grid2">
          <div>
            <div class="muted" style="margin-bottom:6px;">Eda (pünktlich)</div>
            <div class="rows" id="edaRows"></div>
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px;">Kaza</div>
            <div class="rows" id="kazaRows"></div>
          </div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <!-- Backup -->
      <div class="metric">
        <h3>Backup (sehr wichtig)</h3>
        <div class="actions">
          <button class="btn ok" id="btnSaveFile">Backup speichern</button>
          <button class="btn" id="btnLoadFile">Backup laden</button>
          <button class="btn" id="btnExportText">Export (Text)</button>
          <button class="btn" id="btnImportText">Import (Text)</button>
          <button class="btn danger" id="btnResetAll">Alles löschen</button>
        </div>

        <textarea id="backupText" placeholder="Export-Text erscheint hier… (oder Import-Text einfügen)"></textarea>
        <div class="muted" style="margin-top:8px;">
          Empfehlung: „Backup speichern“ → iPhone fragt → speichere in <b>Dateien → iCloud Drive</b>.
          Dann ist es auch bei neuem Handy sicher.
        </div>
      </div>

      <input id="filePicker" type="file" accept="application/json" />
    </div>
  </aside>
</main>

<script>
(() => {
  // ---------- Keys ----------
  const DB_KEY = "namastakip_archive_v3";
  const SETTINGS_KEY = "namastakip_settings_v1";

  // ---------- Config ----------
  const START_YEAR = 2002;
  const END_YEAR   = 2030;

  const PRAYERS = [
    { key: "sabah", label: "Sabah" },
    { key: "ogle",  label: "Öğle"  },
    { key: "ikindi",label: "İkindi"},
    { key: "aksam", label: "Akşam" },
    { key: "yatsi", label: "Yatsı" },
  ];

  // status: 0 empty, 1 eda, 2 kaza
  const symbol = (st) => st === 1 ? "✓" : st === 2 ? "✓" : "•";
  const cls = (st) => st === 1 ? "state1" : st === 2 ? "state2" : "state0";

  // ---------- Helpers ----------
  const pad2 = (n) => String(n).padStart(2,"0");
  const iso = (y,m,d) => `${y}-${pad2(m)}-${pad2(d)}`;
  const daysInMonth = (y,m0) => new Date(y, m0+1, 0).getDate();
  const wd = (dateObj) => ["So","Mo","Di","Mi","Do","Fr","Sa"][dateObj.getDay()];
  const monthName = (m0) => ["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][m0];

  function fmtDE(dateObj){
    return `${wd(dateObj)} ${pad2(dateObj.getDate())}.${pad2(dateObj.getMonth()+1)}.${dateObj.getFullYear()}`;
  }
  function fmtISOShort(dateObj){
    return `${dateObj.getFullYear()}-${pad2(dateObj.getMonth()+1)}-${pad2(dateObj.getDate())}`;
  }

  // ---------- DB ----------
  let db = {};
  try{ db = JSON.parse(localStorage.getItem(DB_KEY) || "{}") || {}; }catch(e){ db = {}; }

  function ensureDay(dateISO){
    if(!db[noteKey(dateISO)]){
      db[noteKey(dateISO)] = {};
      for(const p of PRAYERS) db[noteKey(dateISO)][p.key] = 0;
    }else{
      for(const p of PRAYERS){
        if(typeof db[noteKey(dateISO)][p.key] !== "number") db[noteKey(dateISO)][p.key] = 0;
      }
    }
    return db[noteKey(dateISO)];
  }

  // store keys as dateISO (kept as-is)
  function noteKey(dateISO){ return dateISO; }

  function saveDB(){
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    document.getElementById("saveState").textContent = "Autosave ✅";
  }

  // ---------- Settings ----------
  let settings = { birthDate: "1998-01-01", obligationAge: 10 };
  try{
    const s = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "null");
    if(s && typeof s === "object"){
      settings = { ...settings, ...s };
    }
  }catch(e){}

  function saveSettings(){
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  }

  // ---------- UI ----------
  const selYear = document.getElementById("selYear");
  const selMonth = document.getElementById("selMonth");
  const tbody = document.getElementById("tbody");
  const rangeLabel = document.getElementById("rangeLabel");

  const birthDateInput = document.getElementById("birthDate");
  const btnApplyBirth = document.getElementById("btnApplyBirth");

  const sinceLabel = document.getElementById("sinceLabel");
  const daysReqEl = document.getElementById("daysReq");
  const prayersReqEl = document.getElementById("prayersReq");
  const prayersDoneEl = document.getElementById("prayersDone");
  const prayersLeftEl = document.getElementById("prayersLeft");
  const barFill = document.getElementById("barFill");

  const edaRows = document.getElementById("edaRows");
  const kazaRows = document.getElementById("kazaRows");

  const btnToday = document.getElementById("btnToday");
  const btnClearMonth = document.getElementById("btnClearMonth");

  const btnSaveFile = document.getElementById("btnSaveFile");
  const btnLoadFile = document.getElementById("btnLoadFile");
  const filePicker = document.getElementById("filePicker");
  const btnExportText = document.getElementById("btnExportText");
  const btnImportText = document.getElementById("btnImportText");
  const btnResetAll = document.getElementById("btnResetAll");
  const backupText = document.getElementById("backupText");

  // ---------- Fill selectors ----------
  function fillSelectors(){
    selYear.innerHTML = "";
    for(let y=END_YEAR; y>=START_YEAR; y--){
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = String(y);
      selYear.appendChild(opt);
    }
    selMonth.innerHTML = "";
    for(let m0=0; m0<12; m0++){
      const opt = document.createElement("option");
      opt.value = String(m0);
      opt.textContent = `${pad2(m0+1)} ${monthName(m0)}`;
      selMonth.appendChild(opt);
    }
  }

  // ---------- Render month ----------
  function renderMonth(){
    const year = parseInt(selYear.value,10);
    const m0 = parseInt(selMonth.value,10);
    const dim = daysInMonth(year,m0);

    const startISO = iso(year,m0+1,1);
    const endISO = iso(year,m0+1,dim);
    rangeLabel.textContent = `Zeitraum: ${startISO} bis ${endISO}`;

    const frag = document.createDocumentFragment();

    for(let d=1; d<=dim; d++){
      const dateObj = new Date(year,m0,d);
      const dateISO = iso(year,m0+1,d);
      const day = ensureDay(dateISO);

      const tr = document.createElement("tr");

      const tdDate = document.createElement("td");
      tdDate.textContent = fmtDE(dateObj);
      tr.appendChild(tdDate);

      for(const p of PRAYERS){
        const td = document.createElement("td");
        const b = document.createElement("div");
        b.className = `cellBtn ${cls(day[p.key]||0)}`;
        b.textContent = symbol(day[p.key]||0);

        b.addEventListener("click", () => {
          const rec = ensureDay(dateISO);
          const cur = rec[p.key] || 0;
          const next = (cur + 1) % 3;
          rec[p.key] = next;

          b.className = `cellBtn ${cls(next)}`;
          b.textContent = symbol(next);

          saveDB();
          updateStats(); // global stats + trackers
        });

        td.appendChild(b);
        tr.appendChild(td);
      }

      frag.appendChild(tr);
    }

    tbody.innerHTML = "";
    tbody.appendChild(frag);

    updateStats();
  }

  // ---------- Progress / Stats ----------
  function obligationStartDate(){
    // start = birthDate + 10 years
    const bd = settings.birthDate || "1998-01-01";
    const [y,m,d] = bd.split("-").map(n => parseInt(n,10));
    const start = new Date(y + (settings.obligationAge||10), (m-1), d);
    start.setHours(0,0,0,0);
    return start;
  }

  function updateStats(){
    // Count done prayers across ALL saved entries (sparse).
    let doneTotal = 0;
    const eda = Object.fromEntries(PRAYERS.map(p=>[p.key,0]));
    const kaza = Object.fromEntries(PRAYERS.map(p=>[p.key,0]));

    for(const dateISO in db){
      const rec = db[dateISO];
      if(!rec || typeof rec !== "object") continue;
      for(const p of PRAYERS){
        const v = rec[p.key] || 0;
        if(v === 1){ doneTotal++; eda[p.key]++; }
        else if(v === 2){ doneTotal++; kaza[p.key]++; }
      }
    }

    // Required prayers from obligation start to today (inclusive)
    const start = obligationStartDate();
    const today = new Date();
    today.setHours(0,0,0,0);

    // If start is in future, required = 0
    let daysReq = 0;
    if(start <= today){
      const ms = (today.getTime() - start.getTime());
      // inclusive: difference in days + 1
      daysReq = Math.floor(ms / 86400000) + 1;
    }

    const prayersReq = daysReq * 5;
    const left = Math.max(0, prayersReq - doneTotal);
    const pct = prayersReq > 0 ? Math.min(100, Math.max(0, (doneTotal / prayersReq) * 100)) : 0;

    sinceLabel.textContent = fmtISOShort(start);
    daysReqEl.textContent = String(daysReq);
    prayersReqEl.textContent = String(prayersReq);
    prayersDoneEl.textContent = String(doneTotal);
    prayersLeftEl.textContent = String(left);
    barFill.style.width = `${pct.toFixed(2)}%`;

    // render trackers
    edaRows.innerHTML = "";
    kazaRows.innerHTML = "";

    for(const p of PRAYERS){
      edaRows.appendChild(makeRow(p.label, eda[p.key]));
      kazaRows.appendChild(makeRow(p.label, kaza[p.key]));
    }
  }

  function makeRow(label, value){
    const el = document.createElement("div");
    el.className = "row";
    el.innerHTML = `<div>${label}</div><div class="badge">${value}</div>`;
    return el;
  }

  // ---------- Actions ----------
  btnToday.addEventListener("click", () => {
    const now = new Date();
    selYear.value = String(now.getFullYear());
    selMonth.value = String(now.getMonth());
    renderMonth();
  });

  btnClearMonth.addEventListener("click", () => {
    const ok = confirm("Diesen Monat wirklich löschen? (nur gespeicherte Daten)");
    if(!ok) return;

    const y = parseInt(selYear.value,10);
    const m0 = parseInt(selMonth.value,10);
    const dim = daysInMonth(y,m0);

    for(let d=1; d<=dim; d++){
      const key = iso(y,m0+1,d);
      if(db[key]) delete db[key];
    }
    saveDB();
    renderMonth();
  });

  selYear.addEventListener("change", renderMonth);
  selMonth.addEventListener("change", renderMonth);

  // Birth settings
  birthDateInput.value = settings.birthDate;
  btnApplyBirth.addEventListener("click", () => {
    if(!birthDateInput.value){
      alert("Bitte ein Geburtsdatum auswählen.");
      return;
    }
    settings.birthDate = birthDateInput.value;
    saveSettings();
    updateStats();
    alert("Gespeichert ✅");
  });

  // Backup: File save/load
  btnSaveFile.addEventListener("click", () => {
    // combine db + settings
    const payload = { version: 3, savedAt: new Date().toISOString(), settings, db };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
    const now = new Date();
    const stamp = `${now.getFullYear()}-${pad2(now.getMonth()+1)}-${pad2(now.getDate())}`;
    const filename = `namastakip-backup-${stamp}.json`;

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1200);
  });

  btnLoadFile.addEventListener("click", () => {
    filePicker.value = "";
    filePicker.click();
  });

  filePicker.addEventListener("change", async () => {
    const f = filePicker.files && filePicker.files[0];
    if(!f) return;
    try{
      const txt = await f.text();
      const obj = JSON.parse(txt);

      // allow either {db,settings} or plain db
      if(obj && typeof obj === "object" && obj.db && obj.settings){
        db = obj.db || {};
        settings = { ...settings, ...(obj.settings || {}) };
        birthDateInput.value = settings.birthDate || "1998-01-01";
      } else if(obj && typeof obj === "object") {
        db = obj;
      } else {
        throw new Error("ungültig");
      }

      localStorage.setItem(DB_KEY, JSON.stringify(db));
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
      renderMonth();
      alert("Backup geladen ✅");
    }catch(e){
      alert("Backup konnte nicht geladen werden (ungültige Datei).");
    }
  });

  // Backup: text export/import
  btnExportText.addEventListener("click", () => {
    const payload = { version: 3, savedAt: new Date().toISOString(), settings, db };
    backupText.value = JSON.stringify(payload);
    backupText.focus(); backupText.select();
  });

  btnImportText.addEventListener("click", () => {
    const txt = (backupText.value || "").trim();
    if(!txt) return alert("Bitte erst Import-Text einfügen.");
    try{
      const obj = JSON.parse(txt);
      if(obj && typeof obj === "object" && obj.db){
        db = obj.db || {};
        settings = { ...settings, ...(obj.settings || {}) };
        birthDateInput.value = settings.birthDate || "1998-01-01";
      } else if(obj && typeof obj === "object") {
        db = obj;
      } else throw new Error("ungültig");
      localStorage.setItem(DB_KEY, JSON.stringify(db));
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
      renderMonth();
      alert("Import abgeschlossen ✅");
    }catch(e){
      alert("Import fehlgeschlagen: ungültiger Text.");
    }
  });

  btnResetAll.addEventListener("click", () => {
    const ok = confirm("Wirklich ALLE Daten auf diesem Gerät löschen?");
    if(!ok) return;
    db = {};
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    renderMonth();
  });

  // ---------- Boot ----------
  fillSelectors();

  // default month: today
  const now = new Date();
  const y = Math.max(START_YEAR, Math.min(END_YEAR, now.getFullYear()));
  selYear.value = String(y);
  selMonth.value = String(now.getMonth());

  renderMonth();
})();
</script>

</body>
</html>